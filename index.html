<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ChatGPT 支付短链接提取器</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@500;700;900&family=Exo+2:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --void: #020305;
      --deep: #05080f;
      --surface: #080e1c;
      --raised: #0c1526;
      --amber: #ff9500;
      --amber-glow: rgba(255,149,0,0.6);
      --amber-dim: rgba(255,149,0,0.15);
      --gold: #ffd060;
      --red: #ff3b30;
      --green: #30d158;
      --blue: #0a84ff;
      --text: #f0dfc0;
      --muted: #6b5a3e;
      --dim: #2a1f10;
      --border: rgba(255,149,0,0.25);
      --border-hi: rgba(255,149,0,0.6);
      --mono: 'Share Tech Mono', monospace;
      --display: 'Orbitron', sans-serif;
      --body: 'Exo 2', sans-serif;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    html, body { height: 100%; }

    body {
      background: var(--void);
      font-family: var(--body);
      color: var(--text);
      overflow: hidden;
      height: 100vh;
    }

    /* ── ATMOSPHERIC LAYERS ── */
    #atmo {
      position: fixed; inset: 0;
      pointer-events: none;
      z-index: 0;
    }

    /* Perspective grid floor */
    #atmo::before {
      content: '';
      position: absolute;
      inset: 0;
      background-image:
        linear-gradient(rgba(255,149,0,0.07) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,149,0,0.07) 1px, transparent 1px);
      background-size: 60px 60px;
      transform: perspective(600px) rotateX(62deg) scale(2) translateY(28vh);
      transform-origin: center 80%;
      opacity: 0.5;
    }

    /* Vignette */
    #atmo::after {
      content: '';
      position: absolute; inset: 0;
      background: radial-gradient(ellipse at 50% 50%, transparent 35%, rgba(2,3,5,0.85) 100%);
    }

    /* Top glow bar */
    .glow-bar {
      position: fixed; top: 0; left: 0; right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--amber), transparent);
      box-shadow: 0 0 20px 4px var(--amber-glow);
      z-index: 10;
    }

    /* Scanlines */
    .scanlines {
      position: fixed; inset: 0;
      pointer-events: none;
      z-index: 9;
      background: repeating-linear-gradient(
        0deg,
        transparent, transparent 3px,
        rgba(0,0,0,0.07) 3px, rgba(0,0,0,0.07) 4px
      );
    }

    /* Ambient blobs */
    .blob1, .blob2 {
      position: fixed;
      border-radius: 50%;
      pointer-events: none;
      filter: blur(80px);
      z-index: 0;
    }
    .blob1 {
      width: 500px; height: 300px;
      top: -80px; right: -100px;
      background: rgba(255,149,0,0.08);
    }
    .blob2 {
      width: 400px; height: 400px;
      bottom: -100px; left: -80px;
      background: rgba(10,132,255,0.07);
    }

    /* ── LAYOUT ── */
    .app {
      position: relative; z-index: 2;
      width: 100vw; height: 100vh;
      display: flex;
      flex-direction: column;
      padding: clamp(24px, 3vw, 44px) clamp(24px, 5vw, 80px);
      gap: 20px;
    }

    /* ── HEADER ── */
    .header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
    }

    .brand {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .brand-label {
      font-family: var(--mono);
      font-size: 10px;
      color: var(--muted);
      letter-spacing: 0.25em;
      text-transform: uppercase;
    }

    .brand-label span {
      color: var(--amber);
    }

    h1 {
      font-family: var(--display);
      font-size: clamp(18px, 3vw, 32px);
      font-weight: 700;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--amber);
      text-shadow:
        0 0 8px var(--amber-glow),
        0 0 30px rgba(255,149,0,0.3);
      line-height: 1;
    }

    .hud-meta {
      text-align: right;
      display: flex;
      flex-direction: column;
      gap: 4px;
      align-items: flex-end;
    }

    .hud-line {
      font-family: var(--mono);
      font-size: 10px;
      color: var(--dim);
      letter-spacing: 0.1em;
    }

    .hud-line.live { color: var(--muted); }
    .hud-line.live::before {
      content: '◆ ';
      color: var(--green);
      animation: pulse 1.8s infinite;
    }

    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.2} }

    /* ── WORKBENCH ── */
    .workbench {
      flex: 1;
      display: grid;
      grid-template-rows: 1fr auto;
      gap: 12px;
      min-height: 0;
    }

    /* Panel base */
    .panel {
      background: var(--surface);
      border: 1px solid var(--border);
      position: relative;
    }

    /* Corner decorations */
    .panel::before, .panel::after {
      content: '';
      position: absolute;
      width: 18px; height: 18px;
      border-color: var(--amber);
      border-style: solid;
      z-index: 1;
    }
    .panel::before { top: -1px; left: -1px; border-width: 2px 0 0 2px; box-shadow: -2px -2px 8px rgba(255,149,0,0.3); }
    .panel::after  { bottom: -1px; right: -1px; border-width: 0 2px 2px 0; box-shadow: 2px 2px 8px rgba(255,149,0,0.3); }

    /* Panel header bar */
    .panel-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 16px;
      border-bottom: 1px solid var(--border);
      background: rgba(255,149,0,0.04);
    }

    .panel-bar-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .panel-dot {
      width: 7px; height: 7px;
      background: var(--amber);
      transform: rotate(45deg);
      box-shadow: 0 0 6px var(--amber-glow);
    }

    .panel-title {
      font-family: var(--display);
      font-size: 9px;
      font-weight: 500;
      letter-spacing: 0.25em;
      text-transform: uppercase;
      color: var(--amber);
    }

    .panel-status {
      font-family: var(--mono);
      font-size: 10px;
      color: var(--muted);
      letter-spacing: 0.1em;
    }

    /* Textarea input */
    .editor {
      width: 100%;
      height: calc(100% - 41px);
      background: transparent;
      border: none;
      outline: none;
      resize: none;
      color: var(--text);
      font-family: var(--mono);
      font-size: clamp(13px, 1.4vw, 16px);
      line-height: 1.7;
      padding: 20px;
      letter-spacing: 0.04em;
    }

    .editor::placeholder { color: var(--dim); font-size: 13px; }
    .editor:focus { background: rgba(255,149,0,0.015); }

    /* Output panel */
    .output-panel {
      min-height: 72px;
    }

    .output-content {
      padding: 14px 20px;
      font-family: var(--mono);
      font-size: clamp(13px, 1.3vw, 15px);
      letter-spacing: 0.06em;
      word-break: break-all;
      line-height: 1.6;
      color: var(--gold);
      text-shadow: 0 0 12px rgba(255,208,96,0.4);
      min-height: 30px;
    }

    .output-content.ready { color: var(--muted); text-shadow: none; font-size: 13px; }
    .output-content.error {
      color: var(--red);
      text-shadow: 0 0 10px rgba(255,59,48,0.4);
    }

    /* ── CONTROLS ── */
    .controls {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      flex-wrap: wrap;
    }

    .btn {
      font-family: var(--mono);
      font-size: 11px;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      background: transparent;
      border: 1px solid var(--border);
      color: var(--muted);
      padding: 12px 28px;
      cursor: pointer;
      transition: all 0.18s;
      position: relative;
      clip-path: polygon(0 0, calc(100% - 10px) 0, 100% 10px, 100% 100%, 10px 100%, 0 calc(100% - 10px));
    }

    .btn::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(255,149,0,0.05) 0%, transparent 60%);
      opacity: 0;
      transition: opacity 0.18s;
    }

    .btn:hover {
      border-color: var(--amber);
      color: var(--amber);
      box-shadow: 0 0 14px rgba(255,149,0,0.25), inset 0 0 8px rgba(255,149,0,0.06);
    }
    .btn:hover::after { opacity: 1; }

    .btn.primary {
      border-color: rgba(255,149,0,0.5);
      color: var(--amber);
      background: rgba(255,149,0,0.07);
    }
    .btn.primary:hover {
      background: rgba(255,149,0,0.15);
      box-shadow: 0 0 20px rgba(255,149,0,0.35), inset 0 0 12px rgba(255,149,0,0.08);
    }

    /* Keyboard hint */
    .hint-row {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 2px;
    }
    .kbd {
      font-family: var(--mono);
      font-size: 10px;
      color: var(--dim);
      background: var(--raised);
      border: 1px solid rgba(255,149,0,0.1);
      padding: 2px 7px;
      letter-spacing: 0.05em;
    }
    .hint-text {
      font-family: var(--mono);
      font-size: 10px;
      color: var(--dim);
      letter-spacing: 0.08em;
    }

    /* ── FOOTER ── */
    .footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-top: 1px solid var(--border);
      padding-top: 10px;
    }

    .footer-left {
      font-family: var(--mono);
      font-size: 10px;
      color: var(--dim);
      letter-spacing: 0.1em;
    }

    .footer-right {
      display: flex;
      gap: 18px;
    }

    .footer-stat {
      font-family: var(--mono);
      font-size: 10px;
      color: var(--dim);
      letter-spacing: 0.06em;
    }

    .footer-stat span { color: var(--muted); }

    /* ── GLITCH ANIMATION ── */
    @keyframes glitch {
      0%,95%,100% { text-shadow: 0 0 8px var(--amber-glow), 0 0 30px rgba(255,149,0,0.3); clip-path: none; transform: none; }
      96% { clip-path: polygon(0 20%, 100% 20%, 100% 40%, 0 40%); transform: skewX(-2deg) translateX(2px); text-shadow: 2px 0 var(--red), -2px 0 var(--blue); }
      97% { clip-path: polygon(0 60%, 100% 60%, 100% 80%, 0 80%); transform: skewX(1.5deg) translateX(-1px); text-shadow: -2px 0 var(--red), 2px 0 var(--blue); }
      98% { clip-path: none; transform: none; }
    }

    h1 { animation: glitch 6s infinite; }

    @media (max-width: 640px) {
      .app { padding: 16px; gap: 12px; }
      .hud-meta { display: none; }
      .hint-row { display: none; }
      .controls { justify-content: stretch; }
      .btn { flex: 1; justify-content: center; text-align: center; padding: 12px 16px; }
    }
  </style>
</head>
<body>
  <div id="atmo" aria-hidden="true"></div>
  <div class="blob1" aria-hidden="true"></div>
  <div class="blob2" aria-hidden="true"></div>
  <div class="scanlines" aria-hidden="true"></div>
  <div class="glow-bar" aria-hidden="true"></div>

  <main class="app">

    <header class="header">
      <div class="brand">
        <div class="brand-label">// <span>CHATGPT</span> PAYMENT SYSTEM</div>
        <h1>Link Extractor</h1>
      </div>
      <div class="hud-meta">
        <div class="hud-line live">SYSTEM ONLINE</div>
        <div class="hud-line" id="clockLine">──</div>
        <div class="hud-line">VER 1.0.0</div>
      </div>
    </header>

    <div class="workbench">

      <!-- Input panel -->
      <div class="panel">
        <div class="panel-bar">
          <div class="panel-bar-left">
            <div class="panel-dot"></div>
            <div class="panel-title">Input Stream</div>
          </div>
          <div class="panel-status" id="charCount">AWAITING INPUT</div>
        </div>
        <textarea id="longUrl" class="editor" placeholder="PASTE FULL URL OR RAW TEXT HERE...&#10;&#10;支持直接粘贴包含链接的整段文字"></textarea>
      </div>

      <!-- Output panel -->
      <div class="panel output-panel">
        <div class="panel-bar">
          <div class="panel-bar-left">
            <div class="panel-dot"></div>
            <div class="panel-title">Extracted Output</div>
          </div>
          <div class="panel-status" id="outputStatus">READY</div>
        </div>
        <div id="result" class="output-content ready">READY.</div>
      </div>

    </div>

    <div class="controls">
      <div class="hint-row">
        <span class="kbd">Ctrl</span><span class="hint-text">+</span><span class="kbd">Enter</span>
        <span class="hint-text">快速提取</span>
      </div>
      <button id="extractBtn" class="btn primary">[ Extract ]</button>
      <button id="copyBtn" class="btn">[ Copy ]</button>
    </div>

    <footer class="footer">
      <div class="footer-left">CHATGPT CHECKOUT PROCESSOR // SHORT LINK ENGINE</div>
      <div class="footer-right">
        <div class="footer-stat">OPS <span id="opCount">0</span></div>
        <div class="footer-stat">STATUS <span id="statusText">IDLE</span></div>
      </div>
    </footer>

  </main>

  <script>
    // ── HUD clock ──
    function updateClock() {
      const now = new Date();
      const h = String(now.getHours()).padStart(2,'0');
      const m = String(now.getMinutes()).padStart(2,'0');
      const s = String(now.getSeconds()).padStart(2,'0');
      document.getElementById('clockLine').textContent = `${h}:${m}:${s} UTC+8`;
    }
    updateClock(); setInterval(updateClock, 1000);

    // ── Char count ──
    const longUrl = document.getElementById('longUrl');
    longUrl.addEventListener('input', () => {
      const len = longUrl.value.length;
      document.getElementById('charCount').textContent = len > 0 ? `${len} CHARS` : 'AWAITING INPUT';
    });

    // ── Ops counter ──
    let ops = 0;
    function incOps() {
      ops++;
      document.getElementById('opCount').textContent = ops;
    }

    // ── Core logic ──
    function parseUrlFromText(input) {
      const raw = input.trim();
      if (!raw) throw new Error('请输入链接。');
      const urlMatch = raw.match(/https?:\/\/[^\s"'<>]+/i);
      const candidate = urlMatch ? urlMatch[0] : raw;
      try { return new URL(candidate); }
      catch { throw new Error('链接格式无效，请检查是否完整。'); }
    }

    function getParam(url, key) {
      const fromSearch = url.searchParams.get(key);
      if (fromSearch) return fromSearch;
      const hash = url.hash.startsWith('#') ? url.hash.slice(1) : url.hash;
      return new URLSearchParams(hash).get(key);
    }

    function extractShortCheckoutUrl(input) {
      const url = parseUrlFromText(input);
      const shortMatch = url.pathname.match(/^\/checkout\/([^/]+)\/([^/?#]+)/);
      if (shortMatch) return `https://chatgpt.com/checkout/${shortMatch[1]}/${shortMatch[2]}`;
      const payPathMatch = url.pathname.match(/^\/c\/pay\/(cs_[^/?#]+)/i) ||
        url.pathname.match(/^\/pay\/(cs_[^/?#]+)/i);
      const sessionId =
        (payPathMatch ? payPathMatch[1] : null) ||
        getParam(url,'checkout_session_id') ||
        getParam(url,'session_id') ||
        getParam(url,'checkoutSessionId');
      const processor = getParam(url,'processor_entity') || getParam(url,'processor') || 'openai_llc';
      if (!sessionId) throw new Error('未找到 checkout_session_id / session_id 参数，无法提取。');
      return `https://chatgpt.com/checkout/${processor}/${sessionId}`;
    }

    // ── UI helpers ──
    const result = document.getElementById('result');
    const outputStatus = document.getElementById('outputStatus');
    const statusText = document.getElementById('statusText');

    function setOutput(text, mode) {
      result.textContent = text;
      result.className = 'output-content' + (mode ? ' ' + mode : '');
      outputStatus.textContent = mode === 'error' ? 'ERROR' : mode === 'ready' ? 'READY' : 'OK';
      statusText.textContent = mode === 'error' ? 'ERR' : mode === 'ready' ? 'IDLE' : 'DONE';
    }

    function runExtract() {
      incOps();
      try {
        const url = extractShortCheckoutUrl(longUrl.value);
        setOutput(url, '');
      } catch(e) {
        setOutput('❌ ' + e.message, 'error');
      }
    }

    document.getElementById('extractBtn').addEventListener('click', runExtract);

    longUrl.addEventListener('keydown', e => {
      if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') runExtract();
    });

    document.getElementById('copyBtn').addEventListener('click', async () => {
      const text = result.textContent.trim();
      if (!text || text.startsWith('❌') || text === 'READY.') {
        setOutput('❌ 当前没有可复制的短链接。', 'error'); return;
      }
      try { await navigator.clipboard.writeText(text); }
      catch {
        const t = document.createElement('textarea');
        t.value = text; document.body.appendChild(t); t.select();
        document.execCommand('copy'); t.remove();
      }
      setOutput(text + '  ✓ COPIED', '');
    });
  </script>
</body>
</html>
